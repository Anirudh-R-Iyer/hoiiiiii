:root{
  --bg:#0b0b1a;
  --accent:#ff5c8a;
  --paper:#f9f4e6;
  --scroll-border:#b89b66;
}
html,body{height:100%;margin:0;font-family:'Press Start 2P', monospace;background:var(--bg);color:#fff;}
body { -webkit-font-smoothing: none; image-rendering: pixelated; text-rendering: geometricPrecision; }

.scene{
  position:relative;
  min-height:100vh;
  overflow:hidden;
  background: linear-gradient(180deg, rgba(10,8,30,1) 0%, rgba(7,6,18,1) 70%);
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Easter egg filter */
.scene.kapi-filter{
  filter: saturate(1.25) contrast(1.05);
}
.scene.kapi-filter::after{
  content:"";
  position:absolute; inset:-20px;
  background:
    radial-gradient(circle at 20% 20%, rgba(255,255,255,0.10), transparent 45%),
    radial-gradient(circle at 80% 70%, rgba(255,122,168,0.10), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25));
  pointer-events:none;
  mix-blend-mode:screen;
}

.starfield{
  position:absolute; inset:0; pointer-events:none;
  background-image:
    radial-gradient(circle at 10% 20%, #fff 0.5px, transparent 1px),
    radial-gradient(circle at 30% 10%, #fff 0.6px, transparent 1px),
    radial-gradient(circle at 70% 30%, #fff 0.4px, transparent 1px),
    radial-gradient(circle at 85% 15%, #fff 0.5px, transparent 1px),
    radial-gradient(circle at 60% 60%, #fff 0.4px, transparent 1px),
    radial-gradient(circle at 20% 80%, #fff 0.5px, transparent 1px),
    radial-gradient(circle at 40% 50%, #fff 0.4px, transparent 1px);
  animation: twinkle 3s infinite linear;
  opacity:0.95;
  mix-blend-mode:screen;
}

/* Canvas for rose + fireworks */
.fx-canvas{
  position:absolute;
  inset:0;
  z-index:0;
  pointer-events:none;
}

/* Extra star dots added via JS */
.star{
  position:absolute;
  width:2px;height:2px;
  background:#fff;
  opacity:0.9;
  transform: translateZ(0);
  animation: starFlicker var(--tw, 3.2s) infinite steps(2);
}
@keyframes starFlicker{
  0%{opacity:0.2; transform:scale(1)}
  50%{opacity:1; transform:scale(1.6)}
  100%{opacity:0.25; transform:scale(1)}
}
@keyframes twinkle{
  0%{filter:brightness(1) saturate(1)}
  50%{filter:brightness(1.6) saturate(1.2)}
  100%{filter:brightness(1)}
}

.moon{
  position:absolute;
  right:8%;
  top:6%;
  width:120px;height:120px;
  border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff 18%, #e7e7e7 35%, #bfbfbf 100%);
  box-shadow:0 0 30px rgba(255,255,255,0.08);
  transform:translateZ(0);
}

/* Hills background */
.hills{
  position:absolute; left:0; right:0; bottom:0;
  height:42vh;
  pointer-events:none;
  z-index:1;
  background:
    radial-gradient(120% 90% at 15% 120%, rgba(40,190,120,0.16) 0%, rgba(0,0,0,0) 55%),
    radial-gradient(120% 90% at 55% 125%, rgba(80,240,170,0.14) 0%, rgba(0,0,0,0) 58%),
    radial-gradient(120% 90% at 95% 120%, rgba(40,170,120,0.14) 0%, rgba(0,0,0,0) 55%),
    linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.25) 55%, rgba(0,0,0,0.55) 100%);
}
.hills::before,
.hills::after{
  content:"";
  position:absolute; left:-10%; right:-10%; bottom:-6%;
  height:65%;
  background:
    radial-gradient(80% 120% at 20% 100%, rgba(28,120,78,0.55) 0%, rgba(28,120,78,0.55) 45%, rgba(0,0,0,0) 60%),
    radial-gradient(90% 120% at 55% 100%, rgba(22,92,60,0.55) 0%, rgba(22,92,60,0.55) 48%, rgba(0,0,0,0) 63%),
    radial-gradient(80% 120% at 85% 100%, rgba(16,72,48,0.55) 0%, rgba(16,72,48,0.55) 45%, rgba(0,0,0,0) 60%);
  filter: blur(0.5px);
  opacity:0.95;
}
.hills::after{
  bottom:-10%;
  height:55%;
  opacity:0.8;
  transform: scaleX(1.06);
  filter: blur(1px);
}

/* Falling petals */
.petals{ position:absolute; inset:0; pointer-events:none; z-index:6; }
.petal{
  position:absolute;
  top:-10vh;
  width:8px; height:6px;
  background: rgba(255, 116, 170, 0.95);
  border-radius: 70% 30% 70% 30%;
  filter: drop-shadow(0 2px 0 rgba(0,0,0,0.25));
  transform: rotate(var(--r, 0deg));
  opacity: var(--o, 0.9);
  animation:
    petalFall var(--d, 8s) linear infinite,
    petalSway var(--s, 2.8s) ease-in-out infinite,
    petalSpin var(--p, 2.6s) linear infinite;
}
@keyframes petalFall{
  0%{ transform: translateY(-10vh) translateX(0) rotate(var(--r,0deg)); }
  100%{ transform: translateY(110vh) translateX(var(--x, 30px)) rotate(calc(var(--r,0deg) + 220deg)); }
}
@keyframes petalSway{ 0%,100%{ margin-left:-10px } 50%{ margin-left:10px } }
@keyframes petalSpin{ 0%{ filter: drop-shadow(0 2px 0 rgba(0,0,0,0.25)); } 50%{ filter: drop-shadow(0 3px 0 rgba(0,0,0,0.35)); } }
.moon::after{
  content:"";
  position:absolute; left:60%; top:30%; width:28px; height:28px; background:rgba(0,0,0,0.12); border-radius:50%;
}

.garden{
  position:absolute; bottom:6%; left:50%; transform:translateX(-50%); display:flex; gap:18px; align-items:flex-end;
  z-index:2;
}
.rose{
  width:78px; height:104px; transform-origin:center bottom; image-rendering:pixelated;
  filter: drop-shadow(0 4px 0 rgba(0,0,0,0.6));
  transition:transform .4s steps(1);
}
.rose svg { width:100%; height:100%; display:block; image-rendering:pixelated; }
.rose.bloom { animation: bloom 1s forwards steps(6); }
@keyframes bloom{
  0%{transform:translateY(20px) scale(.4) rotate(-6deg)}
  60%{transform:translateY(-6px) scale(1.06) rotate(4deg)}
  100%{transform:translateY(0) scale(1) rotate(0)}
}

.center-content { z-index:5; text-align:center; padding:12px; pointer-events:none;}
.title { font-size:18px; color:var(--accent); margin-bottom:12px; text-shadow:0 2px 0 rgba(0,0,0,0.6); pointer-events:auto; }
.sub { font-size:10px; color:#ddd; }

.modal {
  position:fixed;
  left:50%; top:50%;
  transform:translate(-50%,-50%);
  background:rgba(255,255,255,0.06);
  border:4px solid rgba(255,255,255,0.06);
  padding:20px 24px;
  border-radius:10px;
  backdrop-filter: blur(6px);
  z-index:20;
  min-width:280px;
  max-width:92%;
  pointer-events:auto;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}
.modal .question {
  font-size:14px; color:#fff; margin-bottom:16px;
}
.modal .buttons { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
button.pixel {
  font-family:inherit; font-size:12px; padding:10px 14px; border-radius:6px; border:3px solid #fff3;
  background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(0,0,0,0.06));
  color:#fff; cursor:pointer; outline:none;
  position:relative;
  transition:transform .08s steps(1);
}
button.pixel:active{ transform:translateY(2px); }
.hint { font-size:9px; color:#ddd; opacity:0.9; margin-top:10px; text-align:center; width:100%; }

.modal .hint{ width:100%; text-align:center; }

.scroll-wrap{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.8));
  z-index:40; padding:24px; gap:20px; flex-direction:column;
  visibility:hidden; opacity:0; transition:opacity .5s ease;
}
.scroll-wrap.show{ visibility:visible; opacity:1; pointer-events:auto; }

.scroll {
  width:min(880px,95%); max-height:80vh; overflow:auto;
  background: linear-gradient(180deg, #fbf4dc, #f3ecd9 40%, #efe3c9 100%);
  border:12px solid var(--scroll-border); border-radius:10px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  padding:32px 30px; position:relative;
  font-size:12px; color:#222; line-height:1.6;
}

/* Embedded pixel-art knight+frog watermark (SVG data URI) */
.scroll::before{
  content:"";
  position:absolute; inset:0; 
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 120'><rect width='100%' height='100%' fill='none'/><g opacity='0.08' fill='%23bfb294'><!-- knight (left) pixel style --><rect x='10' y='20' width='10' height='10' /><rect x='20' y='20' width='10' height='10' /><rect x='12' y='30' width='10' height='10' /><rect x='18' y='10' width='8' height='6' /><rect x='10' y='38' width='30' height='6' rx='1' /><!-- frog (right) pixel style --><rect x='140' y='48' width='8' height='6' /><rect x='148' y='44' width='8' height='8' /><rect x='156' y='52' width='8' height='6' /><rect x='144' y='40' width='4' height='4' /><rect x='164' y='40' width='4' height='4' /></g></svg>");
  background-repeat:no-repeat; background-position:center; background-size:55%;
  mix-blend-mode:multiply; pointer-events:none;
}

.typewriter { font-family:'Press Start 2P', monospace; white-space:pre-wrap; white-space:break-spaces; font-size:12px; color:#111; }

.controls { position:fixed; left:12px; bottom:12px; z-index:60; display:flex; gap:8px; align-items:center; }
.controls button { font-family:inherit; padding:8px 10px; border-radius:6px; border:2px solid #fff2; background:rgba(255,255,255,0.03); color:#fff; cursor:pointer; }

/* Kapi Dawara sitting on the moon (sprite-like, not a button) */
.kapi-moon{
  position:absolute;
  /* offset so it sits on the moon but doesn't make the whole moon feel clickable */
  right: calc(8% + 18px);
  top: calc(6% + 18px);
  z-index:76;
  width:84px;
  height:84px;
  background: transparent;
  border:0;
  padding:0;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transform: translateZ(0);
}
.kapi-moon:active{ transform: translateY(1px); }

.kapi-sprite{
  width:78px;
  height:78px;
  image-rendering:pixelated;
  filter: drop-shadow(0 3px 0 rgba(0,0,0,0.45));
  background-repeat:no-repeat;
  background-position:center;
  background-size:contain;
  /* pixel-art door + cup */
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80' shape-rendering='crispEdges'><rect width='80' height='80' fill='none'/><g><rect x='18' y='24' width='44' height='46' fill='%23251a35'/><rect x='22' y='28' width='36' height='38' fill='%23331f4a'/><rect x='22' y='28' width='36' height='6' fill='%234a2a6a'/><rect x='28' y='40' width='24' height='22' fill='%232a163f'/><rect x='46' y='50' width='4' height='4' fill='%23ffd166'/><rect x='20' y='22' width='40' height='4' fill='%23ff5c8a'/><rect x='18' y='24' width='4' height='46' fill='%23ff5c8a'/><rect x='58' y='24' width='4' height='46' fill='%23ff5c8a'/><rect x='18' y='68' width='44' height='4' fill='%23ff5c8a'/></g><g><rect x='50' y='18' width='18' height='12' rx='2' fill='%23ffffff' opacity='0.9'/><rect x='52' y='20' width='14' height='8' rx='2' fill='%23dfe7ff' opacity='0.9'/><rect x='66' y='22' width='6' height='6' rx='3' fill='none' stroke='%23ffffff' stroke-width='3' opacity='0.85'/><rect x='54' y='23' width='6' height='3' fill='%23c98b3a' opacity='0.9'/></g></svg>");
}

/* Glitter around the sprite so it's obvious */
.kapi-sparkles{
  position:absolute;
  inset:-10px;
  pointer-events:none;
  border-radius:999px;
  background-image:
    radial-gradient(circle at 18% 28%, rgba(255,255,255,0.95) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 80% 20%, rgba(255,255,255,0.85) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 62% 78%, rgba(255,255,255,0.85) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 22% 74%, rgba(255,255,255,0.90) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 92% 62%, rgba(255,255,255,0.75) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 48% 14%, rgba(255,255,255,0.80) 0 1px, rgba(255,255,255,0) 2px);
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.18));
  opacity:0.88;
  animation: glitterTwinkle 1.6s steps(2) infinite;
}
.kapi-sparkles::before,
.kapi-sparkles::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:999px;
  background-image:
    radial-gradient(circle at 30% 40%, rgba(255,255,255,0.90) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 84% 38%, rgba(255,255,255,0.70) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 52% 88%, rgba(255,255,255,0.82) 0 1px, rgba(255,255,255,0) 2px),
    radial-gradient(circle at 18% 16%, rgba(255,255,255,0.78) 0 1px, rgba(255,255,255,0) 2px);
  opacity:0.65;
  animation: glitterTwinkle 1.9s steps(2) infinite reverse;
}
.kapi-sparkles::after{
  opacity:0.5;
  transform: rotate(12deg);
}

@keyframes glitterTwinkle{
  0%{ opacity:0.85; transform: translateY(0px) scale(1); }
  50%{ opacity:0.55; transform: translateY(-1px) scale(1.02); }
  100%{ opacity:0.9; transform: translateY(0px) scale(1); }
}


/* Montage overlay */
.montage{
  position:fixed; inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,0.65), rgba(0,0,0,0.88));
  z-index:80;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px;
  visibility:hidden;
  opacity:0;
  transition: opacity .25s ease;
}
.montage.show{ visibility:visible; opacity:1; }
.montage-card{
  width:min(1100px, 98%);
  max-height:90vh;
  overflow:hidden;
  border-radius:14px;
  border:4px solid rgba(255,255,255,0.10);
  background: rgba(18,14,38,0.82);
  backdrop-filter: blur(8px);
  box-shadow: 0 20px 70px rgba(0,0,0,0.7);
}
.montage-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:14px 14px 10px;
  border-bottom:2px solid rgba(255,255,255,0.07);
}
.montage-title{ color:var(--accent); font-size:12px; }
.montage-actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
.file-btn{ display:inline-flex; align-items:center; justify-content:center; }
.montage-sub{
  padding:10px 14px;
  font-size:10px;
  color:#e9e9e9;
  border-bottom:2px solid rgba(255,255,255,0.05);
}
.montage-body{
  display:grid;
  grid-template-columns: 1.3fr 0.7fr;
  gap:14px;
  padding:14px;
  max-height: calc(90vh - 120px);
  overflow:auto;
}
.montage-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap:10px;
}
.moment{
  position:relative;
  border-radius:12px;
  overflow:hidden;
  border:3px solid rgba(255,255,255,0.10);
  cursor:pointer;
  background: rgba(255,255,255,0.04);
  min-height:110px;
}
.moment img{ width:100%; height:100%; object-fit:cover; display:block; image-rendering:auto; }
.moment::after{
  content:"click to store";
  position:absolute; left:8px; bottom:8px;
  font-size:8px;
  padding:4px 6px;
  border-radius:8px;
  background: rgba(0,0,0,0.55);
  border:1px solid rgba(255,255,255,0.12);
  opacity:0;
  transition: opacity .15s ease;
}
.moment:hover::after{ opacity:1; }
.moment.pop{ animation: pop 0.35s steps(2); }
@keyframes pop{ 0%{ transform: scale(1) } 50%{ transform: scale(1.04) } 100%{ transform: scale(1) } }

.kapi-drawer{
  border:3px dashed rgba(255,255,255,0.18);
  border-radius:14px;
  padding:10px;
  background: rgba(0,0,0,0.18);
}
.drawer-title{ font-size:10px; color:#fff; margin-bottom:10px; }
.drawer-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap:8px;
  min-height:120px;
}
.drawer-grid .slot{
  border-radius:10px;
  overflow:hidden;
  border:2px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  aspect-ratio: 1 / 1;
}
.drawer-grid .slot img{ width:100%; height:100%; object-fit:cover; display:block; }

@media (max-width:900px){
  .montage-body{ grid-template-columns: 1fr; }
  .drawer-grid{ grid-template-columns: repeat(4, minmax(0, 1fr)); }
}

@media (max-width:520px){
  .moon{ width:80px;height:80px; right:6%; top:6%;}
  .rose{ width:56px; height:74px;}
  .kapi-moon{ width:60px; height:60px; right: calc(6% + 12px); top: calc(6% + 12px); }
  .kapi-sprite{ width:48px; height:48px; }
  .title { font-size:12px }
  .modal { min-width:240px; padding:16px; }
  .scroll { padding:20px; font-size:11px; }
}


@keyframes shake{
  0%,100%{ transform: translateX(0); }
  20%{ transform: translateX(-4px); }
  40%{ transform: translateX(4px); }
  60%{ transform: translateX(-3px); }
  80%{ transform: translateX(3px); }
}
.modal.shake{ animation: shake .35s steps(2) 0s 3; }
